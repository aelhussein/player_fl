2025-01-16 12:49:18,625 - FMNIST_learning_rate - INFO - Starting hyperparameter tuning experiment
2025-01-16 12:49:18,625 - FMNIST_learning_rate - INFO - Testing learning rates: [0.001, 0.0005, 0.0001, 8e-05]
2025-01-16 12:49:18,627 - FMNIST_learning_rate - INFO - Starting Run 1/5
2025-01-16 12:49:18,627 - FMNIST_learning_rate - INFO - Starting tuning for: 0.001
2025-01-16 12:49:18,841 - FMNIST_learning_rate - INFO - Starting server type: local
concurrent.futures.process._RemoteTraceback: 
"""
Traceback (most recent call last):
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/clients.py", line 141, in train_epoch
    model = state.model.train().to(self.device)
  File "/gpfs/commons/home/aelhussein/anaconda3/envs/cuda_env_ne1/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1340, in to
    return self._apply(convert)
  File "/gpfs/commons/home/aelhussein/anaconda3/envs/cuda_env_ne1/lib/python3.9/site-packages/torch/nn/modules/module.py", line 900, in _apply
    module._apply(fn)
  File "/gpfs/commons/home/aelhussein/anaconda3/envs/cuda_env_ne1/lib/python3.9/site-packages/torch/nn/modules/module.py", line 900, in _apply
    module._apply(fn)
  File "/gpfs/commons/home/aelhussein/anaconda3/envs/cuda_env_ne1/lib/python3.9/site-packages/torch/nn/modules/module.py", line 927, in _apply
    param_applied = fn(param)
  File "/gpfs/commons/home/aelhussein/anaconda3/envs/cuda_env_ne1/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1326, in convert
    return t.to(
  File "/gpfs/commons/home/aelhussein/anaconda3/envs/cuda_env_ne1/lib/python3.9/site-packages/torch/cuda/__init__.py", line 305, in _lazy_init
    raise RuntimeError(
RuntimeError: Cannot re-initialize CUDA in forked subprocess. To use CUDA with multiprocessing, you must use the 'spawn' start method

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/gpfs/commons/home/aelhussein/anaconda3/envs/cuda_env_ne1/lib/python3.9/concurrent/futures/process.py", line 246, in _process_worker
    r = call_item.fn(*call_item.args, **call_item.kwargs)
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/servers.py", line 59, in _train_client
    return client.train(personal)
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/clients.py", line 168, in train
    final_loss = self.train_epoch(personal)
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/clients.py", line 161, in train_epoch
    del batch_x, batch_y, outputs, loss
UnboundLocalError: local variable 'batch_x' referenced before assignment
"""

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/run.py", line 38, in <module>
    main()
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/run.py", line 31, in main
    run_experiments(args.dataset, experiment_type)
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/run.py", line 11, in run_experiments
    return experiment.run_experiment()
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/pipeline.py", line 120, in run_experiment
    return self._run_hyperparameter_tuning()
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/pipeline.py", line 169, in _run_hyperparameter_tuning
    self._hyperparameter_tuning(hyperparams, remaining_server_types)
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/pipeline.py", line 194, in _hyperparameter_tuning
    metrics = self._train_and_evaluate(server, server.config.rounds)
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/pipeline.py", line 356, in _train_and_evaluate
    server.train_round()
  File "/gpfs/commons/groups/gursoy_lab/aelhussein/layer_pfl/code/servers.py", line 85, in train_round
    client_train_loss = future.result()
  File "/gpfs/commons/home/aelhussein/anaconda3/envs/cuda_env_ne1/lib/python3.9/concurrent/futures/_base.py", line 439, in result
    return self.__get_result()
  File "/gpfs/commons/home/aelhussein/anaconda3/envs/cuda_env_ne1/lib/python3.9/concurrent/futures/_base.py", line 391, in __get_result
    raise self._exception
UnboundLocalError: local variable 'batch_x' referenced before assignment
